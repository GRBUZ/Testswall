<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Debug – Influencers Wall</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:20px;}
  h1{font-size:18px;margin:0 0 12px;}
  .ok{color:#16a34a;font-weight:700}
  .err{color:#dc2626;font-weight:700}
  table{border-collapse:collapse;width:100%;margin-top:12px}
  th,td{border:1px solid #e5e7eb;padding:8px;font-size:14px}
  th{background:#f8fafc;text-align:left}
  .thumb{width:40px;height:40px;object-fit:cover;border:2px solid #10b981}
  .thumb.err{border-color:#ef4444}
  .muted{color:#6b7280;font-size:13px}
  .controls{display:flex;gap:8px;margin-top:10px}
  button{padding:6px 10px;cursor:pointer}
  code{background:#f3f4f6;padding:2px 4px;border-radius:4px}
</style>
</head>
<body>
  <h1>Debug – purchasedBlocks.json & images</h1>
  <div class="controls">
    <button id="reload">Re-check now</button>
    <span class="muted">Tip: With regions, structure is <code>{"cells":{...},"regions":[...]}</code>.</span>
  </div>
  <div id="status" class="muted" style="margin-top:8px;"></div>
  <table id="tbl" style="display:none">
    <thead>
      <tr>
        <th>Type</th>
        <th>Index / Start</th>
        <th>Size</th>
        <th>Image</th>
        <th>imageUrl</th>
        <th>linkUrl</th>
        <th>Load status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
async function load() {
  const status = document.getElementById('status');
  const tbl = document.getElementById('tbl');
  const tbody = tbl.querySelector('tbody');
  status.textContent = 'Loading data/purchasedBlocks.json …';
  tbl.style.display = 'none';
  tbody.innerHTML = '';

  try {
    const res = await fetch('data/purchasedBlocks.json?ts=' + Date.now());
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();

    let cells = {}, regions = [];
    if (data && (data.cells || data.regions)) {
      cells = data.cells || {};
      regions = data.regions || [];
    } else {
      cells = data || {};
      regions = [];
    }

    const cellEntries = Object.entries(cells);
    const regEntries = regions;

    status.innerHTML = `<span class="ok">JSON OK</span> — ${cellEntries.length} cell(s), ${regEntries.length} region(s).`;
    tbl.style.display = '';

    // Cells (legacy 1x1)
    for (const [idx, { imageUrl, linkUrl }] of cellEntries) {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>cell</td><td>${idx}</td><td>1×1</td>`;
      const tdImg = document.createElement('td');
      const img = document.createElement('img'); img.className='thumb'; img.src=imageUrl; tdImg.appendChild(img);
      const tdUrl = document.createElement('td'); const a1=document.createElement('a'); a1.href=imageUrl; a1.target='_blank'; a1.textContent=imageUrl; tdUrl.appendChild(a1);
      const tdLink = document.createElement('td'); const a2=document.createElement('a'); a2.href=linkUrl||'#'; a2.target='_blank'; a2.textContent=linkUrl||'(missing)'; tdLink.appendChild(a2);
      const tdStatus = document.createElement('td'); tdStatus.textContent='…';
      tr.appendChild(tdImg); tr.appendChild(tdUrl); tr.appendChild(tdLink); tr.appendChild(tdStatus);
      img.onload=()=>{ tdStatus.innerHTML='<span class="ok">IMAGE OK</span>'; img.classList.remove('err'); };
      img.onerror=()=>{ tdStatus.innerHTML='<span class="err">IMAGE ERROR</span>'; img.classList.add('err'); };
      tbody.appendChild(tr);
    }

    // Regions
    for (const r of regEntries) {
      const tr = document.createElement('tr');
      const size = `${r.w||1}×${r.h||1}`;
      tr.innerHTML = `<td>region</td><td>${r.start}</td><td>${size}</td>`;
      const tdImg = document.createElement('td');
      const img = document.createElement('img'); img.className='thumb'; img.src=r.imageUrl; tdImg.appendChild(img);
      const tdUrl = document.createElement('td'); const a1=document.createElement('a'); a1.href=r.imageUrl; a1.target='_blank'; a1.textContent=r.imageUrl; tdUrl.appendChild(a1);
      const tdLink = document.createElement('td'); const a2=document.createElement('a'); a2.href=r.linkUrl||'#'; a2.target='_blank'; a2.textContent=r.linkUrl||'(missing)'; tdLink.appendChild(a2);
      const tdStatus = document.createElement('td'); tdStatus.textContent='…';
      tr.appendChild(tdImg); tr.appendChild(tdUrl); tr.appendChild(tdLink); tr.appendChild(tdStatus);
      img.onload=()=>{ tdStatus.innerHTML='<span class="ok">IMAGE OK</span>'; img.classList.remove('err'); };
      img.onerror=()=>{ tdStatus.innerHTML='<span class="err">IMAGE ERROR</span>'; img.classList.add('err'); };
      tbody.appendChild(tr);
    }
  } catch (e) {
    status.innerHTML = `<span class="err">JSON ERROR</span> — ${e.message}.`;
  }
}

document.getElementById('reload').addEventListener('click', load);
load();
</script>
</body>
</html>
